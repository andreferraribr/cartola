---
title: "Cartola Siafi Futebol Clube:"
subtitle: "comparação entre receita e despesa dos clubes e dos órgão federais"
output:
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
options(digits = 2)
```


```{r, message=FALSE}
library(dplyr)
library(readxl)
library(ggplot2)
library(stringr)
library(plotly)
library(ggrepel)
```



```{r}
clubes <- read_excel("clubes.xlsx")
```


```{r}
clubes<- clubes%>%
  mutate (despesa = receita - resultado)%>%
  mutate (absoluto = abs(resultado))%>%
  mutate (tag = if_else(rank(-absoluto) > 5,   "", clube)  )
```

[https://vuorre.netlify.com/post/2017/01/04/how-to-create-within-subject-scatter-plots-in-r-with-ggplot2/]

```{r}

lims <- c(0, max(c(max(clubes$despesa),max(clubes$receita))))




p_clubes <- plot_ly(clubes)%>%
  ggplot +
  geom_point(aes ( x = despesa, y = receita, color = resultado, size = absoluto, label = clube))+
  geom_text(aes ( x = despesa, y = receita, label = tag))+
  scale_color_gradient2(midpoint=0, low="red", mid="gray",
                     high="blue", space ="Lab" )+
    geom_abline() +
    scale_x_continuous("Despesa", limits = lims) +
    scale_y_continuous("Receita", limits = lims) +
    theme(aspect.ratio = 1)
 
chart_link = api_create(p_clubes, filename="clubes")
chart_link  

p_clubes
```

```{r}
gov <- read_excel("org.xlsx")
colnames(gov)<- c("poder_cod","poder","org_max_cod","org_max","org_sup_cod","org_sup", "org_cod","org","uf","uf_nome","muni_cod","muni","ug_cod","ug","despesa","receita","resultado")




```


```{r}

gov%>% group_by(org_max)%>%
  summarise( count = n())%>%
  arrange(desc(count))

p_org<- plot_ly(gov)%>%
  group_by(org_max)%>%
  summarise( count = n())%>%
  ggplot+
  geom_col(aes(y = count, x = reorder (org_max, count)))+
  coord_flip()



p_org




```

```{r}

lim_gov <- gov %>%
  select(org_max,org_max_cod, ug, receita, despesa, resultado, absoluto, tag)%>%
  filter ( org_max_cod == "22000")%>%
  mutate (absoluto = abs(resultado))%>%
  mutate (tag = if_else(rank(-absoluto) > 5,   "", ug)  )


lims <- c(0, max(c(max(lim_gov$despesa),max(lim_gov$receita))))




p_gov <- plot_ly(lim_gov)%>%
  ggplot +
  geom_point(aes ( x = despesa, y = receita, color = resultado,size = absoluto, label = ug))+
  geom_text(aes ( x = despesa, y = receita, label = tag))+
  scale_color_gradient2(midpoint=0, low="red", mid="gray",
                     high="blue", space ="Lab" )+
    geom_abline() +
    scale_x_continuous("Despesa", limits = lims) +
    scale_y_continuous("Receita", limits = lims) +
    theme(aspect.ratio = 1)

chart_link = api_create(p_gov, filename="ugs")
chart_link 
  

p_gov
```


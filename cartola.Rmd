---
title: "Cartola Siafi Futebol Clube:"
subtitle: "comparação entre receita e despesa dos clubes e dos órgão federais"
output:
  html_document:
    code_folding: hide
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
options(digits = 2)
```


```{r, message=FALSE}
library(dplyr)
library(readxl)
library(ggplot2)
library(stringr)
library(plotly)
library(ggrepel)
library(DT)
```



```{r}
clubes <- read_excel("clubes.xlsx")
```


```{r}
clubes<- clubes%>%
  mutate (despesa = receita - resultado)%>%
  mutate (absoluto = abs(resultado))%>%
  mutate (tag = if_else(rank(-absoluto) > 5,   "", clube)  )
```

[https://vuorre.netlify.com/post/2017/01/04/how-to-create-within-subject-scatter-plots-in-r-with-ggplot2/]


```{r}


lims_clube <- c(0, max(c(max(clubes$despesa),max(clubes$receita))))

p_clubes <-  ggplot (clubes) +
  geom_point(aes ( x = despesa, y = receita, color = resultado, size = absoluto, label = clube))+
  geom_text(aes ( x = despesa, y = receita, label = tag))+
  scale_color_gradient2(midpoint=0, low="red", mid="gray",
                     high="blue", space ="Lab" )+
    geom_abline() +
    scale_x_continuous("Despesa", limits = lims_clube) +
    scale_y_continuous("Receita", limits = lims_clube) 
(p_clubes <- ggplotly(p_clubes))




```

```{r}
gov <- read_excel("org.xlsx")
colnames(gov)<- c("poder_cod","poder","org_max_cod","org_max","org_sup_cod","org_sup", "org_cod","org","uf","uf_nome","muni_cod","muni","ug_cod","ug","despesa","receita","resultado")

gov$receita <- round(gov$receita/1000000,1)
gov$despesa <- round(gov$despesa/1000000,1)
gov$resultado <- round(gov$resultado/1000000,1)





```


```{r}

gov%>% group_by(org_max, org_max_cod)%>%
  summarise( count = n())%>%
  arrange(desc(count))





datatable(gov%>%  select(poder,org_max,org,uf,ug,ug_cod, receita, despesa, resultado),
          filter = 'top', options = list(  pageLength = 5, autoWidth = TRUE, style = "default", width = 1200))

p_org<- gov%>%
  group_by(org_max)%>%
  summarise( count = n())%>%
  ggplot+
  geom_col(aes(y = count, x = reorder (org_max, count)))+
  coord_flip()



(p_org <- ggplotly(p_org))






```

```{r}

lim_gov <- gov %>%
  filter ( org_max_cod != "01000")%>%
  mutate (absoluto = abs(resultado))%>%
  mutate (tag = if_else(rank(-absoluto) > 5,   "", ug_cod)  )


lims_gov <- c(0, max(c(max(lim_gov$despesa),max(lim_gov$receita))))

#lim_gov$tag <- gsub(" ", "\n", lim_gov$tag)
#levels(lim_gov$ug) <- gsub(" ", "\n", levels(lim_gov$ug))


p_gov <-   ggplot (lim_gov) +
  geom_point(aes ( x = despesa, y = receita, color = resultado,size = absoluto, label = ug))+
  geom_text(aes ( x = despesa, y = receita, label = tag))+
  scale_color_gradient2(midpoint=0, low="red", mid="gray",
                     high="blue", space ="Lab" )+
    geom_abline() +
    scale_x_continuous("Despesa", limits = lims_gov) +
    scale_y_continuous("Receita", limits = lims_gov)

 
  
(p_gov <- ggplotly(p_gov) )





```



```{r}

```

